<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Prototipo</title>
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, user-scalable=no,  initial-scale=1, maximun-scale=1, minimun-scale=1"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/addons/p5.sound.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/skeleton-tracing-js/dist/trace_skeleton.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="cliente/src/clienteWS.js"></script>
    <script src="cliente/src/controlWeb.js"></script>
    <script src="cliente/src/clienteRest.js"></script>
    <script src="cliente/src/sketch.js"></script>
    <link rel="stylesheet" type="text/css" href="cliente/css/style.css">
    <link rel="stylesheet" type="text/css" href="cliente/css/fontello.css">
  </head>
  <!--script type="text/javascript">
    var canv = document.getElementsByTagName('canvas')[0];
    console.log(canv);
    canv.hidden=true;
  </script-->

  <body>
    <div id="openModal"></div>
    <header class="header">
      <div class="contenedor">
        <h1 class="icon-photo">Prototipo App v0.0</h1>
        <img src="cliente/img/uclm.png" class="bannerImg">
      </div>
    </header>
    <main class="main">
      <div class="contenedor" id="contenedorPrincipal">
        <div class="resultado" id="canvasPosition" style="visibility: hidden;"></div>
        <div id="ang"></div>
        <div id="btnDownload"></div>
        <section class="info" id="main">
          <article style="visibility: hidden;">
            <script type="text/javascript" src="cliente/src/sketch.js"></script>
          </article>
          <article class="infoColumna">
            <form id="subir">
              <div class="image-take">
                <label for="file-input">
                    <img src="cliente/img/camara.png" alt ="Click aquí para hacer tu foto" title ="Click aquí para tomar tu foto" > 
                </label>
                <input id="file-input" name="foto" type="file"/ accept="image/*" capture="camera">
                <h2 class="infoTitulo">Click en la imagen para tomar foto</h2>
              </div>
            </form>
          </article>
          <article class="infoColumna">
            <div class="image-upload">
              <label for="btnUpload">
                  <img src="cliente/img/cargar1.gif" alt ="Click aquí para subir tu foto" title ="Click aquí para subir tu foto" > 
              </label>
              <input id="btnUpload" name="upload" type="button" style="display: none;" onclick="onUpload();"/>
              <h2 class="infoTitulo">Click en la imagen para subir foto</h2>
            </div>
          </article>
        </section>
      </div>
  </main>

  <footer class="footer">
    <p class="autor">&copy; Universidad de Castilla-La Mancha 2021</p>
    <p class="autor">Miguel Angel Picazo Fernandez   -  MiguelAngel.Picazo@alu.uclm.es</p>
  </footer>

  <div id="openModal" class="modalDialog">
    <div>
      <a href="#close" title="Close" class="close">X</a>
      <h2>No has tomado una foto, tomala</h2>
    </div>
  </div>
    
    <script type="text/javascript">
      var cw=new ControlWeb($);
      var ws = new ClienteWS();
      ws.ini();

      var cliR = new ClienteRest();

      function onUpload() {
        if(document.getElementById('file-input').files.length != 0){
          var myInput = document.getElementById('file-input');
          var file = myInput.files[0].name;
          var form = document.getElementById('subir');
          var formData = new FormData(form);
          formData.append('image', file);
          ws.setName(file);
          ws.obtenerCodigo();
          if(!document.getElementById('canvasPosition')){
            cw.crear();
          }
          cliR.subirImg(formData);
        }else{
          cw.mostrarModal();
        }
      }

    </script>

    <script type="text/javascript">
      var canvas = document.getElementsByTagName("canvas")[0];
      function descargar(){
        var image = document.getElementById("myCanvas").toDataURL("image/png");
        var msg = JSON.stringify(image);
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/download');
        xhr.send(msg, ws.name);
        //cliR.subirImg(link.href);
      }
    </script>

    <script type="text/javascript">
      function volver(){
        cw.volverPrincipal();
      }
    </script>
  </body>
</html>
